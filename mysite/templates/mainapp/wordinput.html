<!DOCTYPE HTML>
<head>
	<script >
const responses=[]
const maxResponses=4
var sent=false

// Comprovacions:
// 	- Encara es poden posar més paraules
// 	- No s'ha enviat la llista
// 	- Trim
function getName(){
const logInput=document.getElementById("error-input")
if(sent){
    logInput.style.color="red"
    logInput.innerText="Already sent"
    return
}
const textField=document.getElementById("paraula-input")
if(textField.value.trim().length==0){
    return
}
if(responses.length>=maxResponses){
    logInput.style.color="red"
    logInput.innerText="You can't add more than "+maxResponses+" words"
    textField.style.backgroundColor= "#fce4e4"
    textField.style.border= "1px solid #cc0033"
    textField.style.outline= "none"
    return
}
logInput.style=""
logInput.innerText=""
const word=textField.value.trim()
textField.style.all="revert"
textField.value=""
responses.push(word)
document.getElementById("llista-paraules").innerHTML+='<li class="list-group-item active">'+word+'</li>'
}

function submitWords(){
if(sent){
    return
}
const logInput=document.getElementById("error-input")
if(responses.length<maxResponses){
    const textField=document.getElementById("paraula-input")
    logInput.style.color="red"
    if(responses.length==0){
        logInput.innerText="You must be so fun at parties..."
    }else{
        logInput.innerText="You just added "+responses.length+" of "+maxResponses+" possible words"
    }
    textField.style.backgroundColor= "#fce4e4"
    textField.style.border= "1px solid #cc0033"
    textField.style.outline= "none"
    return
}
logInput.style.color="green"
logInput.innerText="Successfully sent"
const text=JSON.stringify({responses})
// CANVIAR PER FER LA PETICIÓ
const form = document.createElement('form');
form.method = "post";
form.action = "/game";
document.body.appendChild(form);
const formField = document.createElement('data');
formField.type = 'hidden';
form.appendChild(formField);

var i = document.createElement("input");
i.setAttribute('name', 'csrfmiddlewaretoken');
i.setAttribute('value', '{{ csrf_token }}');
form.appendChild(i);
form.submit();

let xhr = new XMLHttpRequest();
xhr.open("POST", "/game");
xhr.send(text);
console.log(text)
sent=true
}
    </script>
</head>
<body>
	<input type="text" id="paraula-input" placeholder="New word">
	<button type="submit" class="btn btn-info" id="button-word" onclick="getName()">Send</button>
	<ul id="llista-paraules">
	</ul>
	<button type="submit" class="btn btn-info" id="button-submit" onclick="submitWords()">Submit words</button>
	<p id="error-input"></p>
</body>
{% csrf_token %}